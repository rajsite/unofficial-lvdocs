<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>


<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252">
<title>Building a Function Prototype</title>
<meta http-equiv="Content-Style-Type" content="text/css"><link rel="STYLESHEET" type="text/css" href="minimal.css">
<script src="common.js" type="text/javascript"></script>







</head>
<body bgcolor="#ffffff">

<noscript>
<p class="Body">JavaScript is disabled. <a href="../lvhelp/JavaScript_Disabled.html">Details</a></p>
<hr width="100%" noshade>
</noscript>
<h1>Building a Function Prototype</h1>
<p class="Body">To build a shared library from a text-based programming language, you can build a function prototype in LabVIEW and then fill in all the details of the code. When you allow LabVIEW to generate this function prototype, you help ensure that the basic syntax of the code in the shared library is valid. The prototype source file you create is a <span class="Monospace">.c</span> file and contains C declarations for the parameters you want to pass.</p>
<p class="Body">Complete the following steps to build a prototype source file, <span class="Monospace">myshared.c</span>. </p>
<ol>
<li>Open a new, blank VI and save the VI as Array Average.  This function will calculate the average of an array of values.</li>
<li>Add a <a href="../glang/Call_Library_Function.html">Call Library Function Node</a> to the block diagram.<br><br>
<SPAN title=" Add to the block diagram "><a href="javascript:placeObject(object996);"><img src="add.gif" border="0" style="padding-bottom: 4px; vertical-align: middle"></a>&nbsp;Add</SPAN> <SPAN title=" Find on the palette "><a href="javascript:findObject(object996);"><img src="find.gif" border="0" style="padding-bottom: 4px; vertical-align: middle"></a>&nbsp;Find</SPAN></li>
<li>Right-click the Call Library Function Node and select <strong>Configure</strong> from the shortcut menu to open the <a href="../lvdialog/Call_Lib_Function_DB.html">Call Library Function</a> dialog box.</li>
<li>Leave the <strong>Library name or path</strong> control empty.</li>
</ol>
<table class="Borderless">
<tr>
<td class="Icon"><img src="note.gif"></td>
<td>
<strong>Note</strong>&nbsp;&nbsp;Use the <strong>Library name or path</strong> control to specify the shared library the Call Library Function Node <a href="../lvexcodeconcepts/Ex_1_Call_a_Shared_Library.html">calls</a>.</td></tr></table>
<ol start="5">
<li>Enter the following general specifications:
<ol class="List-abc">
<li>Type <span class="Monospace">avg_num</span> in the <strong>Function name</strong> field. </li>
<li>Select the <strong>C</strong> control from the <strong>Calling convention</strong> field.</li>
</ol>
</li>
<li>Define the return value using the following specifications:
<ol class="List-abc">
<li>Navigate to the <strong>Parameters</strong> tab of the <strong>Call Library Function</strong> dialog box.</li>
<li>Change the default name in the  <strong>Name</strong> control from <span class="Monospace">return type</span> to the more descriptive name <span class="Monospace">error</span>.</li>
<li>Select <strong>Numeric</strong> from the <strong>Type</strong> pull-down menu.</li>
<li>Select <strong>Signed 32-bit Integer</strong> from the <strong>Data type</strong> pull-down menu.</li>
</ol>
</li>
<li>Define the <span class="Monospace">a</span> parameter using the following specifications:
<ol class="List-abc">
<li>Click the <strong>Add a parameter</strong> button to the right of the parameter list.</li>
<li>Replace the default name <span class="Monospace">arg1</span> in the <strong>Name</strong> field with the name, <span class="Monospace">a</span>.</li>
<li>Select <strong>Array</strong> from the <strong>Type</strong> pull-down menu.</li>
<li>Select <strong>4-byte Single</strong> from the <strong>Data type</strong> pull-down menu. </li>
<li>Select <strong>Array Data Pointer</strong> from the <strong>Array format</strong> pull-down menu.</li>
</ol>
</li>
<li>Define the <span class="Monospace">size</span> parameter using the following specifications:
<ol class="List-abc">
<li>Click the <strong>Add a parameter</strong> button to the right of the parameter list.</li>
<li>Replace the default name <span class="Monospace">arg2</span> in the <strong>Name</strong> field with the name, <span class="Monospace">size</span>.</li>
<li>Select <strong>Numeric</strong> from the <strong>Type</strong> pull-down menu. </li>
<li>Select <strong>Signed 32-bit Integer</strong> from the <strong>Data type</strong> pull-down menu.</li>
<li>Select <strong>Value</strong> from the <strong>Pass</strong> pull-down menu.</li>
</ol>
</li>
<li>Define the <span class="Monospace">avg</span> parameter using the following specifications:
<ol class="List-abc">
<li>Click the <strong>Add a parameter</strong> button to the right of the parameter list.</li>
<li>Replace the default name <span class="Monospace">arg3</span> in the <strong>Parameter</strong> field with the name, <span class="Monospace">avg</span>.</li>
<li>Select <strong>Numeric</strong> from the <strong>Type</strong> pull-down menu.</li>
<li>Select <strong>4-byte Single</strong> from the <strong>Data type</strong> pull-down menu.</li>
<li>Select <strong>Pointer to Value</strong> from the <strong>Pass</strong> pull-down menu.</li>
</ol>
</li>
<li>Check that the <strong>Function prototype</strong> field displays the return value and three parameters in the correct order, as follows:<br><br>
<span class="Monospace-Bold">int32_t avg_num(float *a, int32_t size, float *avg);</span></li>
</ol>
<table class="Borderless">
<tr>
<td class="Icon"><img src="note.gif"></td>
<td>
<strong>Note</strong>&nbsp;&nbsp;The syntax you see in the<strong> Function Prototype</strong> field is technically correct. However, the <span class="Monospace">.c</span> file that the Call Library Function Node <a href="../lvhowto/Completing_c_File.html">generates</a> is more precise because the first parameter appears as <span class="Monospace-Bold">float a[]</span>.</td></tr></table>
<ol start="11">
<li>Click the <strong>OK</strong> button to save your settings and close the dialog box.</li>
<li>Notice that the Call Library Function Node icon updates to reflect your settings.</li>
<li>Right-click the Call Library Function Node and select <strong>Create C File</strong> from the shortcut menu.</li>
<li>Save the file as <span class="Monospace">myshared.c</span>.</li>
</ol>
<table class="Borderless">
<tr>
<td class="Icon"><img src="note.gif"></td>
<td>
<strong>Note</strong>&nbsp;&nbsp;In this example, you use a <span class="Monospace">.c</span> source file. When you work with C++ libraries, change the extension of the source file to <span class="Monospace">.cpp</span>.</td></tr></table>
<h2>Preventing C++ Name Decoration</h2>
<p class="Body"><!-- begin parent: ../lvdialog/Call_Lib_Function_DB.html -->Keep the C++ compiler from introducing platform dependence in exported function names through a process called name mangling by using the C++ compiler function export directive, extern "C"{}, in your header file<!-- end parent: ../lvdialog/Call_Lib_Function_DB.html -->, as shown in the following example code: </p>  
<p class="Body"><span class="Monospace">extern &quot;C&quot; {</span><br><span class="Monospace">int32_t MyDLLFunction(int32_t nInput, uint32_t nOutput, void *arg1);<br>}</span></p>

<p class="Body"><span class="Monospace">int32_t MyDLLFunction(int32_t nInput, uint32_t nOutput, void *arg1)</span></p>

<p class="Indent1"><span class="Monospace">{</span></p>

<p class="Indent1"><span class="Monospace">/* Insert Code Here */</span></p>

<p class="Indent1"><span class="Monospace">}</span></p>

<table class="Borderless">
<tr>
<td class="Icon"><img src="note.gif"></td>
<td><strong>Note</strong>&nbsp;&nbsp;If you disable C++ decoration of a function, the compiler cannot create polymorphic versions of the function.</td>
</tr>
</table>
<p class="Body">After you build the function prototype, <a href="Completing_c_File.html">complete the .c 
file</a>.</p>
   

</body>
</html>
