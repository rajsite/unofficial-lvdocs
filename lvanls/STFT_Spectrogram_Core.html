<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><!--Generated from database. Edit in the database; do not edit this file.--><!--VI id="415"--><HTML><head><!--LabVIEW VI path:vi.lib\gmath\trans.llb\STFT Spectrograms.vi--><TITLE>STFT Spectrograms VI</TITLE><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Windows-1252"><meta http-equiv="Content-Style-Type" content="text/css"><link rel="STYLESHEET" type="text/css" href="minimal.css"><script src="common.js" type="text/javascript"></script><script src="jquery-1.7.2.min.js" type="text/javascript"></script><script src="cssframes.js" type="text/javascript"></script><link media="print" rel="stylesheet" type="text/css" href="print.css"></head><body bgcolor="#ffffff"><noscript><p class="Body">JavaScript is disabled. <a href="../lvhelp/JavaScript_Disabled.html">Details</a></p><hr width="100%" noshade></noscript><div id="styleDivTitle"><!-- VI or Function Name --><H1>STFT Spectrograms VI</H1><!--Owning Palette--><p class="Body"><strong>Owning Palette:</strong> <a href="../lvanls/Spectral_Analysis_VIs.html">Spectral Analysis VIs</a></p><!--Package and Platform--><p class="Body"><strong>Requires:</strong> Full Development System</p><!-- VI/Function Description --><p class="Body">Computes the signal energy distribution in the joint time-frequency domain, using the short-time Fourier transform (STFT) algorithm.</p><!-- Supplemental VI/Function Information --><!-- Link to Additional VI/Function Information --><p class="Body"><a href="#details">Details</a>&nbsp;&nbsp;<a href="#examples">Example</a></p><!-- Graphic Reference --><MAP NAME="connector_pane"><AREA SHAPE="rect" COORDS="0,10,122,21" HREF="#Input0"><AREA SHAPE="rect" COORDS="0,26,122,34" HREF="#Input1"><AREA SHAPE="rect" COORDS="0,39,122,50" HREF="#Input2"><AREA SHAPE="rect" COORDS="0,53,122,62" HREF="#Input3"><AREA SHAPE="rect" COORDS="0,67,122,78" HREF="#Input4"><AREA SHAPE="rect" COORDS="0,82,122,92" HREF="#Input5"><AREA SHAPE="rect" COORDS="229,25,338,36" HREF="#Output0"><AREA SHAPE="rect" COORDS="229,52,256,58" HREF="#Output1"></MAP><p class="Anchor"><img src="0stftspc.gif" usemap="#connector_pane" border="0"></p><!--Add/Find Buttons--><table class="Borderless"><tr><td><a href="javascript:placeObject(object415);"><img src="add.gif" border="0" style="padding-bottom: 4px; vertical-align: middle"></a>&nbsp;Add to the block diagram</td><td><a href="javascript:findObject(object415);"><img src="find.gif" border="0" style="padding-bottom: 4px; vertical-align: middle"></a>&nbsp;Find on the palette</td></tr></table></div><div id="styleDivScrolling"><!-- Table of VI/Function Parameters --><table class="Borderless"><tr><td class="Icon"><a name="Input0"></a><img src="ccclst.gif"></td><td><strong>time-freq config</strong> specifies the configuration of the <strong>frequency bins</strong>. <strong>time-freq config</strong> also determines the number of columns in <strong>STFT Spectrogram {X}</strong>. <table class="Borderless"><tr><td class="Icon"><img src="cbool.gif"></td><td><strong>force freq bins to power of 2?</strong> specifies whether to coerce the frequency bins to a power of 2. If <strong>force freq bins to power of 2?</strong> is TRUE and <strong>frequency bins</strong> is not a power of 2, this VI sets <strong>frequency bins</strong> to the nearest power of 2. The default is TRUE. </td></tr><tr><td class="Icon"><img src="cbool.gif"></td><td><strong>exclude Nyquist frequency?</strong> specifies whether to exclude the energy at the Nyquist frequency from <strong>STFT Spectrogram {X}</strong>. If <strong>frequency bins</strong> is even and <strong>exclude Nyquist frequency?</strong> is TRUE, <strong>STFT Spectrogram {X}</strong> does not include the energy at the Nyquist frequency. If <strong>frequency bins</strong> is odd, LabVIEW ignores <strong>exclude Nyquist frequency?</strong>. The default is TRUE.</td></tr></table></td></tr><tr><td class="Icon"><a name="Input1"></a><img src="c1ddbl.gif"></td><td><strong>X</strong> specifies the input time-domain signal. </td></tr><tr><td class="Icon"><a name="Input2"></a><img src="cnclst.gif"></td><td><strong>time-freq sampling info</strong> specifies the density to use to sample the signal in the joint time-frequency domain and defines the size of the resulting 2D time-frequency array. <table class="Borderless"><tr><td class="Icon"><img src="ci32.gif"></td><td><strong>time steps</strong> specifies the number of samples to shift the sliding window. When <strong>time steps</strong> is less than or equal to zero, this VI adjusts <strong>time steps</strong> automatically so that no more than 512 rows exist in <strong>STFT Spectrogram {X}</strong>. The default is <span class="Monospace">&#8211;1</span></td></tr><tr><td class="Icon"><img src="ci32.gif"></td><td><strong>frequency bins</strong> specifies the FFT size of the STFT. If <strong>frequency bins</strong> is less than or equal to zero, this VI sets <strong>frequency bins</strong> to 512. If <strong>frequency bins</strong> is 1, this VI coerces <strong>frequency bins</strong> to 2. The default is 512. </td></tr></table></td></tr><tr><td class="Icon"><a name="Input3"></a><img src="cnclst.gif"></td><td><strong>window info</strong> specifies information about the window you want to use to compute the STFT. <table class="Borderless"><tr><td class="Icon"><img src="cu32.gif"></td><td><strong>type</strong> specifies the type of window to use to compute the STFT. The default is <span class="Monospace">Hanning</span>. <br><br><table class="Bordered"><tr><td class = "Bordered">0</td><td class = "Bordered">Rectangle</td></tr><tr><td class = "Bordered">1</td><td class = "Bordered">Hanning</td></tr><tr><td class = "Bordered">2</td><td class = "Bordered">Hamming</td></tr><tr><td class = "Bordered">3</td><td class = "Bordered">Blackman-Harris</td></tr><tr><td class = "Bordered">4</td><td class = "Bordered">Exact Blackman</td></tr><tr><td class = "Bordered">5</td><td class = "Bordered">Blackman</td></tr><tr><td class = "Bordered">6</td><td class = "Bordered">Flat Top</td></tr><tr><td class = "Bordered">7</td><td class = "Bordered">4 Term B-Harris</td></tr><tr><td class = "Bordered">8</td><td class = "Bordered">7 Term B-Harris</td></tr><tr><td class = "Bordered">9</td><td class = "Bordered">Low Sidelobe</td></tr><tr><td class = "Bordered">11</td><td class = "Bordered">Blackman Nuttall</td></tr><tr><td class = "Bordered">30</td><td class = "Bordered">Triangle</td></tr><tr><td class = "Bordered">31</td><td class = "Bordered">Bartlett-Hanning</td></tr><tr><td class = "Bordered">32</td><td class = "Bordered">Bohman</td></tr><tr><td class = "Bordered">33</td><td class = "Bordered">Parzen</td></tr><tr><td class = "Bordered">34</td><td class = "Bordered">Welch</td></tr><tr><td class = "Bordered">60</td><td class = "Bordered">Kaiser</td></tr><tr><td class = "Bordered">61</td><td class = "Bordered">Dolph-Chebyshev</td></tr><tr><td class = "Bordered">62</td><td class = "Bordered">Gaussian</td></tr></table></td></tr><tr><td class="Icon"><img src="ci32.gif"></td><td><strong>length</strong> specifies the length of the window in samples. If <strong>length</strong> is less than or equal to zero, this VI sets <strong>length</strong> to 64. The default is 64. </td></tr></table></td></tr><tr><td class="Icon"><a name="Input4"></a><img src="cdbl.gif"></td><td><strong>window parameter</strong> is the beta parameter for a Kaiser window; the ratio, <em>s</em>, of the mainlobe to the sidelobe for a Dolph-Chebyshev window; and the standard deviation for a Gaussian window. If the window <strong>type</strong> is any other window, this VI ignores this input. The default value of <strong>window parameter</strong> is NaN, which sets beta to 0 for a Kaiser window, <em>s</em> to 60 for a Dolph-Chebyshev window, and the standard deviation to <img src="noloc_eq_gaus_dev.gif"> for a Gaussian window, where <em>L</em> is the window <strong>length</strong>.</td></tr><tr><td class="Icon"><a name="Input5"></a><img src="cbool.gif"></td><td><strong>energy conservation?</strong> specifies whether to scale <strong>STFT Spectrogram {X}</strong> so that the energy in the joint time-frequency domain equals the energy in the time domain. The default is TRUE. </td></tr><tr><td class="Icon"><a name="Output0"></a><img src="i2ddbl.gif"></td><td><strong>STFT Spectrogram {X}</strong> is a 2D array that describes the time waveform energy distribution in the joint time-frequency domain. </td></tr><tr><td class="Icon"><a name="Output1"></a><img src="ii32.gif"></td><td><strong>error</strong> returns any <a href="../lverror/Error_Code_Ranges.html">error</a> or warning from the VI. You can wire <strong>error</strong> to the <a href="../glang/Err_Cluster_from_Code.html">Error Cluster From Error Code</a> VI to convert the error code or warning into an error cluster. </td></tr></table><!-- Additional VI/Function Information --><h2><a name="details">STFT Spectrograms Details</a></h2><p class="Body">To compute <strong>STFT Spectrogram {X}</strong>, this VI first computes the STFT of <strong>X</strong>. To compute the STFT of <strong>X</strong>, this VI uses a sliding window to divide the signal into several blocks of data. The VI then applies an <em>N</em>-points fast Fourier transform to each block of data to obtain the frequency contents of each block of data, where <em>N</em> is <strong>frequency bins</strong>. The STFT aligns the center of the first sliding window with the first sample of the signal <strong>X</strong> and extends the beginning of the signal by adding zeros. The sliding window moves <strong>time steps</strong> samples to the next block of data. If the window moves out of <strong>X</strong>, this VI pads <strong>X</strong> with zeros.</p><p class="Body">The following illustration shows the procedure this VI uses to compute the STFT.</p><img src="loc_eps_stft_spec.gif"><p class="Body">If <strong>force freq bins to power of 2?</strong> is TRUE, and <strong>frequency bins</strong> is not a power of 2, then the following equation also is true:</p><p class="Indent1"><em>K</em> = 2<sup>[log<sub>2</sub>(<strong>frequency bins</strong>)]</sup></p><p class="Body">where [ ] is the nearest operation.</p><p class="Body">Otherwise, <em>K</em> = <strong>frequency bins</strong>.</p><p class="Body">If the result of the STFT is the matrix <em>STFT</em>{<strong>X</strong>}, then the size of <em>STFT</em>{<strong>X</strong>} is <em>M</em>-by-<em>K</em>, where the following are true:</p><ul><li><img src="loc_eq_stft_size_m.gif" align="middle"></li><li><em>L</em> is the number of elements in <strong>X</strong></li><li><img src="noloc_eq_amp_phase_spec_floor.gif" align="middle"> is the round down operation</li></ul><p class="Body">You can use <em>STFT</em>{<strong>X</strong>} to approximate the energy in the joint time-frequency domain using the following expression:</p><p class="Indent1"><img src="loc_eq_stft_energy_jtfd.gif"></p><p class="Body">This result almost equals the energy in the time domain, as shown in the following expression:</p><p class="Indent1"><img src="noloc_eq_stft_energy_td.gif"></p><p class="Body">After computing the STFT of <strong>X</strong>, this VI computes the STFT spectrogram of <strong>X</strong>. This VI calculates STFT spectrogram as the magnitude square of the elements in <em>STFT</em>{<strong>X</strong>}. Because the FFT returns symmetric results, this VI calculates the <strong>STFT Spectrogram {X}</strong> only on the left half of <em>STFT</em>{<strong>X</strong>}, as shown in the following equation:</p><p class="Indent1"><img src="loc_eq_stft_spec_of_x.gif"></p><p class="Body">where the following are true:</p><ul><li><em>i</em> = 0, 1, ..., <em>M</em>&#8211;1</li><li><em>j</em> = 0, 1, ..., <em>N</em>&#8211;1</li><li><img src="loc_eq_stft_spec_n.gif" align="middle"></li><li><img src="noloc_eq_stft_round_up.gif" align="middle"> is the round up operation.</li></ul><p class="Body">If you specify a small value for <strong>time steps</strong>, the VI might return a large spectrogram, which requires a long computation time and more memory. National Instruments recommends you set <strong>time steps</strong> so that the number of rows in <strong>spectrogram</strong> does not exceed 512. If you need a small sampling rate to observe more details and the signal length is large, divide the signal into smaller segments and compute the spectrogram for each segment.</p><p class="Body">The window <strong>length</strong> affects the time resolution and the frequency resolution of the STFT. A narrow window results in a fine time resolution but a coarse frequency resolution because narrow windows have a short time duration but a wide bandwidth. A wide window results in a fine frequency resolution but a coarse time resolution because wide windows have a long time duration but a narrow frequency bandwidth.</p><p class="checkFile lvtimefreqtk Body">This VI returns the same result as the <a href="../lvtimefreqtk/TFA_STFT_Spectrogram.html">TFA STFT Spectrogram</a> VI in the LabVIEW Advanced Signal Processing Toolkit if you set <strong>force freq bins to power of 2?</strong>, <strong>exclude Nyquist frequency?</strong>, and <strong>energy conservation?</strong> to TRUE.</p><!--Module Specific Content--><script type="text/javascript">if (typeof(writeVarRefs)=="function"){writeVarRefs("415");}</script><!-- Example Information --><h2><a name="examples">Example</a></h2><p class="Body">Refer to the STFT Spectrogram Demo VI in the <span class="Monospace">labview\examples\Signal Processing\Transforms</span> directory for an example of using the STFT Spectrograms VI.</p><p class="Body"><a href="javascript:openVI('examples%5C%5CSignal%20Processing%5C%5CTransforms%5C%5CSTFT%20Spectrogram%20Demo.vi');"><img src="open.gif" border="0" style="padding-bottom: 4px; vertical-align: middle"></a>&nbsp;Open example&nbsp;<a href="javascript:findExamples(3749);"><img src="find.gif" border="0" style="padding-bottom: 4px; vertical-align: middle"></a>&nbsp;Find related examples</p></div></body></HTML>